#include <stdlib.h>

#include "sc_textEncoder.h"
#include "huffmanTree.h"

static int _statistics[] = {
//    _0    _1    _2    _3    _4    _5    _6    _7    _8    _9    _A    _B    _C    _D    _E    _F
    0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x7F, 0x01, 0x01, 0x7F, 0x01, 0x01,  // 0_ 
    0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,  // 1_ 
    0xFF, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07,  // 2_ 
    0x25, 0x2F, 0x27, 0x27, 0x26, 0x26, 0x25, 0x24, 0x24, 0x23, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07,  // 3_ 
    0x07, 0x1a, 0x12, 0x14, 0x15, 0x1f, 0x13, 0x13, 0x18, 0x19, 0x10, 0x11, 0x15, 0x13, 0x18, 0x19,  // 4_ 
    0x12, 0x10, 0x18, 0x18, 0x1b, 0x14, 0x11, 0x13, 0x10, 0x13, 0x10, 0x07, 0x07, 0x07, 0x07, 0x07,  // 5_ 
    0x07, 0x3a, 0x32, 0x34, 0x35, 0x3f, 0x33, 0x33, 0x38, 0x39, 0x30, 0x31, 0x35, 0x33, 0x38, 0x39,  // 6_ 
    0x32, 0x30, 0x38, 0x38, 0x3b, 0x34, 0x31, 0x33, 0x30, 0x33, 0x30, 0x07, 0x07, 0x07, 0x07, 0x01,  // 7_ 
    0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,  // 8_ 
    0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,  // 9_ 
    0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,  // A_ 
    0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,  // B_ 
    0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,  // C_ 
    0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,  // D_ 
    0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,  // E_ 
    0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,  // F_ 
};

static huffman_node_t* _root = NULL;

sc_encoder_table_t* _sc_creatTextEncoding(){
    _root = createHuffmanTree(_statistics);
    listHuffmanCodes(_root);

    sc_encoder_table_t* ret = malloc(sizeof(sc_encoder_table_t) +256 *sizeof(sc_encoder_entry_t));
    if(ret != NULL){
        ret->size = 256;
        for(int n = 0; n < 256; n++){
            ret->entries[n].bits = 8;
            ret->entries[n].pattern = n;
        }
    }
    return ret;
}

sc_decoder_table_t* _sc_creatTextDecoding(){
    sc_decoder_table_t* ret = malloc(sizeof(sc_decoder_table_t) +256 *sizeof(sc_decoder_entry_t));
    if(ret != NULL){
        ret->size = 256;
        for(int n = 0; n < 256; n++){
            ret->entries[n].flag_bits = 8;
            ret->entries[n].code = n;
        }
    }
    return ret;
}